### **消息中间件是什么?使用它有什么作用?**

**消息中间件则是将软件与软件之间的交互方式进行存储和管理的一种技术,也可以看做是一种容器。**

消息队列是消息中间件的一种实现方式

作用：

**1、异步处理,提高响应速度**

用并行的方式处理

![img](https://pic4.zhimg.com/80/v2-df1ec81c2bcd47812ec691114e1c5a03_720w.webp)

2、**应用解耦**

![img](https://pic1.zhimg.com/80/v2-98517be1ca806900e20e34206fa85100_720w.webp)

3、**流量削峰:**

设置消息队列容量，避免同时大量请求到达服务器数据库造成压力

![img](https://pic2.zhimg.com/80/v2-a4c062a9e3930db16a59759a63316169_720w.webp)

RabbitMQ可以实现跨平台语言实现，并且提供五种消息模型

## RocketMQ 核心内容

### 1. 主题 Topic

用来标识同一业务逻辑的消息，可用来定义数据的分类隔离和定义数据的身份和权限

![img](https://images-machen.oss-cn-beijing.aliyuncs.com/archifortopic-ef512066703a22865613ea9216c4c300.png)

### 2. 队列 Queue

消息存储和传输的实际容器

### 3. 消息 Message

需要操作的业务逻辑

### 4. 生产者 Producer

发布消息的角色。Producer 通过 MQ 的负载均衡模块选择相应的 Broker 集群队列进行消息投递，**投递的过程支持快速失败和重试。**

### 5. 消费者 Consumer

**支持集群模式和广播模式的消费**

**提供实时消息订阅机制**

### 6.名字服务器NameServer

NameServer 是一个简单的 Topic 路由注册中心，支持 Topic、Broker 的动态注册与发现

- **Broker管理**，NameServer 接受 Broker 集群的注册信息并且保存下来作为路由信息的基本数据。然后提供心跳检测机制，检查 Broker 是否还存活；
- **路由信息管理**，每个 NameServer 将保存关于 Broker 集群的整个路由信息和用于客户端查询的队列信息。Producer 和 Consumer 通过 NameServer 就可以知道整个 Broker 集群的路由信息，从而进行消息的投递和消费。

###  7. 代理服务器 Broker

Broker主要负责消息的存储、投递和查询以及服务高可用保证。

### 工作原理

![img](https://images-machen.oss-cn-beijing.aliyuncs.com/p68921.png)

工作流程

NameServer 启动后监听端口，等待 Broker、Producer、Consumer 连接，相当于一个路由控制中心

 Broker与所有 NameServer 保持长连接，定时发送心跳包。心跳包中包含当前 Broker 信息以及存储所有 Topic 信息

创建 Topic 时需要指定该 Topic 要存储在哪些 Broker 上，也可以在发送消息时自动创建 Topic

生产者发送消息。启动时先跟 NameServer 集群中的其中一台建立长连接，并从 NameServer 中获取当前发送的 Topic 存在于哪些 Broker 上，轮询从队列列表中选择一个队列，然后与队列所在的 Broker 建立长连接从而向 Broker发消息

消费者接受消息。跟其中一台 NameServer 建立长连接，获取当前订阅 Topic 存在哪些 Broker 上，然后直接跟 Broker 建立连接通道，然后开始消费消息